<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA C-MAPSS Engine Health Monitor - CSIR 4PI NAL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-connected {
            background: rgba(22, 101, 52, 0.3);
            border: 1px solid #22c55e;
            color: #86efac;
        }

        .status-simulated {
            background: rgba(120, 53, 15, 0.3);
            border: 1px solid #f59e0b;
            color: #fcd34d;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Controls Grid */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .control-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #334155;
        }

        .control-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .control-input {
            width: 100%;
            background: #334155;
            color: white;
            border: 1px solid #475569;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .control-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .control-row {
            display: flex;
            gap: 0.5rem;
        }

        .control-row input {
            flex: 1;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .rul-display {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        .rul-display span {
            font-size: 1rem;
            color: #94a3b8;
        }

        /* Progress Section */
        .progress-section {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }

        .progress-header span {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .progress-bar-container {
            width: 100%;
            height: 1rem;
            background: #334155;
            border-radius: 9999px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            transition: width 0.3s ease, background-color 0.3s ease;
            border-radius: 9999px;
        }

        .progress-good {
            background: #22c55e;
        }

        .progress-warning {
            background: #eab308;
        }

        .progress-danger {
            background: #ef4444;
        }

        /* Critical Warning */
        .critical-warning {
            background: rgba(127, 29, 29, 0.3);
            border: 1px solid #ef4444;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .critical-warning h4 {
            color: #fca5a5;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .critical-warning p {
            color: #fecaca;
            font-size: 0.875rem;
        }

        /* Sensor Selection */
        .sensor-section {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .sensor-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }

        .sensor-btn {
            padding: 0.5rem 1rem;
            background: #334155;
            color: #cbd5e1;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .sensor-btn:hover {
            background: #475569;
        }

        .sensor-btn.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        /* Sensor Display */
        .sensor-display {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 2rem;
            border: 1px solid #334155;
        }

        .sensor-display-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .sensor-display-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .sensor-display-header p {
            color: #94a3b8;
        }

        .sensor-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .reading-card {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid #475569;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .reading-card h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .reading-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1rem;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid #475569;
        }

        .setting-item {
            text-align: center;
        }

        .setting-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        .setting-value {
            color: #cbd5e1;
            font-weight: 500;
            font-size: 0.875rem;
        }

        /* Health Status Card */
        .health-card {
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 2px solid;
        }

        .health-good {
            background: rgba(22, 101, 52, 0.2);
            border-color: #22c55e;
        }

        .health-warning {
            background: rgba(133, 77, 14, 0.2);
            border-color: #eab308;
        }

        .health-danger {
            background: rgba(127, 29, 29, 0.2);
            border-color: #ef4444;
        }

        .health-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .health-icon {
            width: 32px;
            height: 32px;
        }

        .health-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
        }

        .health-message {
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .health-good .health-message {
            color: #bbf7d0;
        }

        .health-warning .health-message {
            color: #fef08a;
        }

        .health-danger .health-message {
            color: #fecaca;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 1px solid #475569;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-dot {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
        }

        .legend-text {
            font-size: 0.875rem;
            color: #cbd5e1;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 1.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        .footer p {
            margin: 0.25rem 0;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header-title h1 {
                font-size: 1.5rem;
            }

            .sensor-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>üöÄ NASA C-MAPSS Engine Health Monitor</h1>
                    <p>CSIR - 4PI, NAL | Turbofan Engine Predictive Maintenance System - Phase 1</p>
                </div>
                <div id="apiStatus" class="status-badge status-simulated">
                    <div class="status-dot"></div>
                    <span>Simulated Mode</span>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls-grid">
            <div class="control-card">
                <label class="control-label">Engine ID</label>
                <select id="engineId" class="control-input">
                    <option value="1">Engine 1</option>
                    <option value="2">Engine 2</option>
                    <option value="3">Engine 3</option>
                    <option value="4">Engine 4</option>
                    <option value="5">Engine 5</option>
                    <option value="10">Engine 10</option>
                    <option value="25">Engine 25</option>
                    <option value="50">Engine 50</option>
                    <option value="100">Engine 100</option>
                </select>
            </div>

            <div class="control-card">
                <label class="control-label">Current Cycle</label>
                <div class="control-row">
                    <input type="number" id="currentCycle" class="control-input" value="1" min="1" max="192">
                    <button id="playBtn" class="btn btn-primary">Play</button>
                </div>
            </div>

            <div class="control-card">
                <label class="control-label">Remaining Useful Life (RUL)</label>
                <div class="rul-display">
                    <span id="rulValue">191</span> <span>cycles</span>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-header">
                <h3>Engine Lifecycle Progress</h3>
                <span id="progressText">Cycle 1 / 192 (0.5%)</span>
            </div>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar progress-good" style="width: 0.5%"></div>
            </div>
            <div id="criticalWarning" class="critical-warning hidden">
                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                <div>
                    <h4>CRITICAL WARNING</h4>
                    <p id="criticalMessage">Engine lifecycle has exceeded safe operational limits. Immediate maintenance required to prevent catastrophic failure.</p>
                </div>
            </div>
        </div>

        <!-- Sensor Selection -->
        <div class="sensor-section">
            <h3>Select Sensor for Monitoring</h3>
            <div class="sensor-grid" id="sensorGrid">
                <!-- Sensors will be generated by JavaScript -->
            </div>
        </div>

        <!-- Sensor Display -->
        <div class="sensor-display">
            <div class="sensor-display-header">
                <h2>Sensor <span id="sensorName">S1</span> Monitoring</h2>
                <p id="engineInfo">Engine 1 - Cycle 1 of 192</p>
            </div>

            <div class="sensor-content">
                <!-- Reading Card -->
                <div class="reading-card">
                    <h3>Current Reading</h3>
                    <div class="reading-value">
                        <span id="sensorValue">518.6700</span>
                        <span id="loadingSpinner" class="spinner hidden"></span>
                    </div>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <div class="setting-label">Setting 1</div>
                            <div class="setting-value" id="setting1">0.0023</div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">Setting 2</div>
                            <div class="setting-value" id="setting2">0.0003</div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-label">Setting 3</div>
                            <div class="setting-value" id="setting3">100.0</div>
                        </div>
                    </div>
                </div>

                <!-- Health Status Card -->
                <div id="healthCard" class="health-card health-good">
                    <div class="health-header">
                        <svg id="healthIcon" class="health-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="health-title" id="healthStatus">GOOD</h3>
                    </div>
                    <p class="health-message" id="healthMessage">Operating normally - All systems nominal</p>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #22c55e;"></div>
                    <span class="legend-text">Good (0-60%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #eab308;"></div>
                    <span class="legend-text">Warning (60-85%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ef4444;"></div>
                    <span class="legend-text">Danger (85-100%)</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Phase 1 Prototype - Single Sensor Monitoring | Data Source: NASA C-MAPSS Dataset</p>
            <p>Backend: FastAPI | Frontend: HTML + CSS + JavaScript</p>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:8000';
        
        // State
        let engineId = 1;
        let currentCycle = 1;
        let maxCycle = 192;
        let selectedSensor = 's1';
        let isPlaying = false;
        let playInterval = null;
        let apiConnected = false;
        let sensorData = null;

        // DOM Elements
        const elements = {
            engineId: document.getElementById('engineId'),
            currentCycle: document.getElementById('currentCycle'),
            playBtn: document.getElementById('playBtn'),
            rulValue: document.getElementById('rulValue'),
            progressBar: document.getElementById('progressBar'),
            progressText: document.getElementById('progressText'),
            criticalWarning: document.getElementById('criticalWarning'),
            criticalMessage: document.getElementById('criticalMessage'),
            sensorGrid: document.getElementById('sensorGrid'),
            sensorName: document.getElementById('sensorName'),
            engineInfo: document.getElementById('engineInfo'),
            sensorValue: document.getElementById('sensorValue'),
            loadingSpinner: document.getElementById('loadingSpinner'),
            setting1: document.getElementById('setting1'),
            setting2: document.getElementById('setting2'),
            setting3: document.getElementById('setting3'),
            healthCard: document.getElementById('healthCard'),
            healthIcon: document.getElementById('healthIcon'),
            healthStatus: document.getElementById('healthStatus'),
            healthMessage: document.getElementById('healthMessage'),
            apiStatus: document.getElementById('apiStatus')
        };

        // Initialize
        function init() {
            createSensorButtons();
            checkApiConnection();
            attachEventListeners();
            fetchSensorData();
        }

        // Create sensor buttons
        function createSensorButtons() {
            const sensors = Array.from({length: 21}, (_, i) => `s${i + 1}`);
            elements.sensorGrid.innerHTML = sensors.map(sensor => `
                <button class="sensor-btn ${sensor === selectedSensor ? 'active' : ''}" 
                        data-sensor="${sensor}" 
                        onclick="selectSensor('${sensor}')">
                    ${sensor.toUpperCase()}
                </button>
            `).join('');
        }

        // Select sensor
        function selectSensor(sensor) {
            selectedSensor = sensor;
            createSensorButtons();
            elements.sensorName.textContent = sensor.toUpperCase();
            updateDisplay();
        }

        // Check API connection
        async function checkApiConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                if (response.ok) {
                    apiConnected = true;
                    elements.apiStatus.className = 'status-badge status-connected';
                    elements.apiStatus.innerHTML = '<div class="status-dot"></div><span>API Connected</span>';
                    console.log('‚úì Connected to FastAPI backend');
                }
            } catch (error) {
                apiConnected = false;
                console.log('‚ö† API not connected, using simulated data');
            }
        }

        // Fetch sensor data
        async function fetchSensorData() {
            showLoading(true);
            
            try {
                if (apiConnected) {
                    const response = await fetch(
                        `${API_BASE_URL}/api/engine/${engineId}/cycle/${currentCycle}`
                    );
                    
                    if (response.ok) {
                        sensorData = await response.json();
                        maxCycle = sensorData.max_cycle;
                    } else {
                        throw new Error('API error');
                    }
                } else {
                    // Simulated data
                    sensorData = generateSimulatedData();
                }
                
                updateDisplay();
            } catch (error) {
                console.error('Error fetching data:', error);
                sensorData = generateSimulatedData();
                updateDisplay();
            } finally {
                showLoading(false);
            }
        }

        // Generate simulated data
        function generateSimulatedData() {
            const sensors = {};
            for (let i = 1; i <= 21; i++) {
                sensors[`s${i}`] = 500 + Math.random() * 2000;
            }
            
            return {
                engine_id: engineId,
                cycle: currentCycle,
                max_cycle: maxCycle,
                setting1: 0.0023,
                setting2: 0.0003,
                setting3: 100.0,
                sensors: sensors,
                rul: maxCycle - currentCycle
            };
        }

        // Update display
        function updateDisplay() {
            if (!sensorData) return;

            const rul = sensorData.rul;
            const degradationPercent = (currentCycle / maxCycle) * 100;
            
            // Update RUL
            elements.rulValue.textContent = rul;
            
            // Update progress
            elements.progressText.textContent = `Cycle ${currentCycle} / ${maxCycle} (${degradationPercent.toFixed(1)}%)`;
            elements.progressBar.style.width = `${degradationPercent}%`;
            
            // Update progress bar color
            elements.progressBar.className = 'progress-bar ' + 
                (degradationPercent < 60 ? 'progress-good' :
                 degradationPercent < 85 ? 'progress-warning' : 'progress-danger');
            
            // Critical warning
            if (degradationPercent >= 85) {
                elements.criticalWarning.classList.remove('hidden');
                elements.criticalMessage.textContent = 
                    `Engine lifecycle has exceeded safe operational limits (${degradationPercent.toFixed(1)}%). Immediate maintenance required to prevent catastrophic failure.`;
            } else {
                elements.criticalWarning.classList.add('hidden');
            }
            
            // Update sensor value
            elements.sensorValue.textContent = sensorData.sensors[selectedSensor].toFixed(4);
            
            // Update settings
            elements.setting1.textContent = sensorData.setting1;
            elements.setting2.textContent = sensorData.setting2;
            elements.setting3.textContent = sensorData.setting3;
            
            // Update engine info
            elements.engineInfo.textContent = `Engine ${engineId} - Cycle ${currentCycle} of ${maxCycle}`;
            
            // Update health status
            updateHealthStatus(degradationPercent);
        }

        // Update health status
        function updateHealthStatus(degradationPercent) {
            let status, message, cardClass, iconSvg;
            
            if (degradationPercent < 60) {
                status = 'GOOD';
                message = 'Operating normally - All systems nominal';
                cardClass = 'health-good';
                iconSvg = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            } else if (degradationPercent < 85) {
                status = 'WARNING';
                message = 'Monitor closely - Degradation detected';
                cardClass = 'health-warning';
                iconSvg = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>';
            } else {
                status = 'DANGER';
                message = 'Critical - Immediate maintenance required';
                cardClass = 'health-danger';
                iconSvg = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            }
            
            elements.healthCard.className = 'health-card ' + cardClass;
            elements.healthStatus.textContent = status;
            elements.healthMessage.textContent = message;
            elements.healthIcon.innerHTML = iconSvg;
        }

        // Show/hide loading
        function showLoading(show) {
            elements.loadingSpinner.classList.toggle('hidden', !show);
        }

        // Play/Pause functionality
        function togglePlay() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                elements.playBtn.textContent = 'Pause';
                elements.playBtn.className = 'btn btn-danger';
                startAutoPlay();
            } else {
                elements.playBtn.textContent = 'Play';
                elements.playBtn.className = 'btn btn-primary';
                stopAutoPlay();
            }
        }

        function startAutoPlay() {
            playInterval = setInterval(() => {
                if (currentCycle < maxCycle) {
                    currentCycle++;
                    elements.currentCycle.value = currentCycle;
                    fetchSensorData();
                } else {
                    togglePlay();
                }
            }, 800);
        }

        function stopAutoPlay() {
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        // Event listeners
        function attachEventListeners() {
            elements.engineId.addEventListener('change', (e) => {
                engineId = parseInt(e.target.value);
                currentCycle = 1;
                elements.currentCycle.value = 1;
                fetchSensorData();
            });

            elements.currentCycle.addEventListener('change', (e) => {
                currentCycle = Math.min(parseInt(e.target.value) || 1, maxCycle);
                fetchSensorData();
            });

            elements.playBtn.addEventListener('click', togglePlay);
        }

        // Initialize app
        init();
    </script>
</body>
</html>