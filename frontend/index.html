<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA C-MAPSS Engine Health Monitor - CSIR 4PI NAL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            color: #e2e8f0;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-connected {
            background: rgba(22, 101, 52, 0.3);
            border: 1px solid #22c55e;
            color: #86efac;
        }

        .status-simulated {
            background: rgba(120, 53, 15, 0.3);
            border: 1px solid #f59e0b;
            color: #fcd34d;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Controls Grid */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .control-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid #334155;
        }

        .control-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .control-input {
            width: 100%;
            background: #334155;
            color: white;
            border: 1px solid #475569;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .control-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .control-row {
            display: flex;
            gap: 0.5rem;
        }

        .control-row input {
            flex: 1;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .rul-display {
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        .rul-display span {
            font-size: 1rem;
            color: #94a3b8;
        }

        /* Progress Section */
        .progress-section {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
        }

        .progress-header span {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .progress-bar-container {
            width: 100%;
            height: 1rem;
            background: #334155;
            border-radius: 9999px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            transition: width 0.3s ease, background-color 0.3s ease;
            border-radius: 9999px;
        }

        .progress-good {
            background: #22c55e;
        }

        .progress-warning {
            background: #eab308;
        }

        .progress-danger {
            background: #ef4444;
        }

        /* Critical Warning */
        .critical-warning {
            background: rgba(127, 29, 29, 0.3);
            border: 1px solid #ef4444;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .critical-warning h4 {
            color: #fca5a5;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .critical-warning p {
            color: #fecaca;
            font-size: 0.875rem;
        }

        /* Sensor Selection - NEW GROUPED DESIGN */
        .sensor-section {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #334155;
        }

        .sensor-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .sensor-group-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .sensor-group-btn {
            padding: 1rem;
            background: #334155;
            color: #cbd5e1;
            border: 2px solid #475569;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .sensor-group-btn:hover {
            background: #475569;
            border-color: #64748b;
        }

        .sensor-group-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        /* Sensor Display - MULTIPLE SENSOR CARDS */
        .sensor-display {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            padding: 2rem;
            border: 1px solid #334155;
        }

        .sensor-display-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .sensor-display-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .sensor-display-header p {
            color: #94a3b8;
        }

        /* Multi-Sensor Grid Layout */
        .sensors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Individual Sensor Card with Color-Coded Border */
        .sensor-card {
            background: rgba(51, 65, 85, 0.5);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 3px solid;
            transition: all 0.3s ease;
        }

        .sensor-card.health-good {
            border-color: #22c55e;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        .sensor-card.health-warning {
            border-color: #eab308;
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.3);
        }

        .sensor-card.health-danger {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .sensor-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .sensor-card-name {
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
        }

        .sensor-card-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .sensor-card-status.good {
            background: #22c55e;
        }

        .sensor-card-status.warning {
            background: #eab308;
        }

        .sensor-card-status.danger {
            background: #ef4444;
        }

        .sensor-card-value {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .sensor-card-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Settings Display Below Sensor Cards */
        .settings-section {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid #475569;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .settings-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .setting-item {
            text-align: center;
        }

        .setting-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }

        .setting-value {
            color: #cbd5e1;
            font-weight: 600;
            font-size: 1rem;
        }

        /* End of Life Message */
        .end-of-life-message {
            background: rgba(127, 29, 29, 0.4);
            border: 3px solid #dc2626;
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            margin-top: 1.5rem;
            animation: pulse-end 2s infinite;
        }

        @keyframes pulse-end {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.85;
                transform: scale(1.02);
            }
        }

        .end-of-life-message .icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .end-of-life-message h3 {
            color: #fca5a5;
            font-size: 1.75rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .end-of-life-message p {
            color: #fecaca;
            font-size: 1rem;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 1px solid #475569;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-dot {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
        }

        .legend-text {
            font-size: 0.875rem;
            color: #cbd5e1;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 1.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        .footer p {
            margin: 0.25rem 0;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header-title h1 {
                font-size: 1.5rem;
            }

            .sensor-group-grid {
                grid-template-columns: 1fr 1fr;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .sensors-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .end-of-life-message h3 {
                font-size: 1.25rem;
            }

            .end-of-life-message .icon {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>üöÄ NASA C-MAPSS Engine Health Monitor</h1>
                    <p>CSIR - 4PI, NAL | Turbofan Engine Predictive Maintenance System - Phase 1</p>
                </div>
                <div id="apiStatus" class="status-badge status-simulated">
                    <div class="status-dot"></div>
                    <span>Simulated Mode</span>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls-grid">
            <div class="control-card">
                <label class="control-label">Engine ID</label>
                <select id="engineId" class="control-input">
                    <option value="1">Engine 1</option>
                    <option value="2">Engine 2</option>
                    <option value="3">Engine 3</option>
                    <option value="4">Engine 4</option>
                    <option value="5">Engine 5</option>
                    <option value="10">Engine 10</option>
                    <option value="25">Engine 25</option>
                    <option value="50">Engine 50</option>
                    <option value="100">Engine 100</option>
                </select>
            </div>

            <div class="control-card">
                <label class="control-label">Current Cycle</label>
                <div class="control-row">
                    <input type="number" id="currentCycle" class="control-input" value="1" min="1" max="192">
                    <button id="playBtn" class="btn btn-primary">Play</button>
                </div>
            </div>

            <div class="control-card">
                <label class="control-label">Remaining Useful Life (RUL)</label>
                <div class="rul-display">
                    <span id="rulValue">191</span> <span>cycles</span>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-header">
                <h3>Engine Lifecycle Progress</h3>
                <span id="progressText">Cycle 1 / 192 (0.5%)</span>
            </div>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar progress-good" style="width: 0.5%"></div>
            </div>
            <div id="criticalWarning" class="critical-warning hidden">
                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                <div>
                    <h4>CRITICAL WARNING</h4>
                    <p id="criticalMessage">Engine lifecycle has exceeded safe operational limits. Immediate maintenance required to prevent catastrophic failure.</p>
                </div>
            </div>
        </div>

        <!-- Sensor Selection - NEW GROUPED DESIGN -->
        <div class="sensor-section">
            <h3>Select Sensor Group for Monitoring</h3>
            <div class="sensor-group-grid">
                <button class="sensor-group-btn active" onclick="selectSensorGroup(1, 6)">S1 - S6</button>
                <button class="sensor-group-btn" onclick="selectSensorGroup(7, 12)">S7 - S12</button>
                <button class="sensor-group-btn" onclick="selectSensorGroup(13, 18)">S13 - S18</button>
                <button class="sensor-group-btn" onclick="selectSensorGroup(19, 21)">S19 - S21</button>
            </div>
        </div>

        <!-- Sensor Display - MULTIPLE SENSOR CARDS -->
        <div class="sensor-display">
            <div class="sensor-display-header">
                <h2>Sensor Group <span id="sensorGroupName">S1 - S6</span> Monitoring</h2>
                <p id="engineInfo">Engine 1 - Cycle 1 of 192</p>
            </div>

            <!-- Multi-Sensor Cards Grid -->
            <div id="sensorsGrid" class="sensors-grid">
                <!-- Sensor cards will be dynamically generated here -->
            </div>

            <!-- Settings Section -->
            <div class="settings-section">
                <h3>Operational Settings</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">Setting 1</div>
                        <div class="setting-value" id="setting1">0.0023</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Setting 2</div>
                        <div class="setting-value" id="setting2">0.0003</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Setting 3</div>
                        <div class="setting-value" id="setting3">100.0</div>
                    </div>
                </div>

                <!-- End of Life Message -->
                <div id="endOfLifeMessage" class="end-of-life-message hidden">
                    <div class="icon">‚ö†Ô∏è</div>
                    <h3>End of Engine Useful Life</h3>
                    <p>This engine has reached the end of its operational lifecycle</p>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #22c55e;"></div>
                    <span class="legend-text">Good (0-60%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #eab308;"></div>
                    <span class="legend-text">Warning (60-85%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ef4444;"></div>
                    <span class="legend-text">Danger (85-100%)</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Phase 1 Prototype - Multi-Sensor Group Monitoring | Data Source: NASA C-MAPSS Dataset</p>
            <p>Backend: FastAPI | Frontend: HTML + CSS + JavaScript</p>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:8000';
        
        // State
        let engineId = 1;
        let currentCycle = 1;
        let maxCycle = 192;
        let selectedGroupStart = 1;
        let selectedGroupEnd = 6;
        let isPlaying = false;
        let playInterval = null;
        let apiConnected = false;
        let sensorData = null;

        // DOM Elements
        const elements = {
            engineId: document.getElementById('engineId'),
            currentCycle: document.getElementById('currentCycle'),
            playBtn: document.getElementById('playBtn'),
            rulValue: document.getElementById('rulValue'),
            progressBar: document.getElementById('progressBar'),
            progressText: document.getElementById('progressText'),
            criticalWarning: document.getElementById('criticalWarning'),
            criticalMessage: document.getElementById('criticalMessage'),
            sensorGroupName: document.getElementById('sensorGroupName'),
            engineInfo: document.getElementById('engineInfo'),
            sensorsGrid: document.getElementById('sensorsGrid'),
            setting1: document.getElementById('setting1'),
            setting2: document.getElementById('setting2'),
            setting3: document.getElementById('setting3'),
            apiStatus: document.getElementById('apiStatus'),
            endOfLifeMessage: document.getElementById('endOfLifeMessage')
        };

        // Initialize
        function init() {
            checkApiConnection();
            attachEventListeners();
            fetchSensorData();
        }

        // Select sensor group
        function selectSensorGroup(start, end) {
            selectedGroupStart = start;
            selectedGroupEnd = end;
            
            // Update button states
            document.querySelectorAll('.sensor-group-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update header
            elements.sensorGroupName.textContent = `S${start} - S${end}`;
            
            // Update display
            updateDisplay();
        }

        // Check API connection
        async function checkApiConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                if (response.ok) {
                    apiConnected = true;
                    elements.apiStatus.className = 'status-badge status-connected';
                    elements.apiStatus.innerHTML = '<div class="status-dot"></div><span>API Connected</span>';
                    console.log('‚úì Connected to FastAPI backend');
                }
            } catch (error) {
                apiConnected = false;
                console.log('‚ö† API not connected, using simulated data');
            }
        }

        // Fetch sensor data
        async function fetchSensorData() {
            try {
                if (apiConnected) {
                    const response = await fetch(
                        `${API_BASE_URL}/api/engine/${engineId}/cycle/${currentCycle}`
                    );
                    
                    if (response.ok) {
                        sensorData = await response.json();
                        maxCycle = sensorData.max_cycle;
                    } else {
                        throw new Error('API error');
                    }
                } else {
                    // Simulated data
                    sensorData = generateSimulatedData();
                }
                
                updateDisplay();
            } catch (error) {
                console.error('Error fetching data:', error);
                sensorData = generateSimulatedData();
                updateDisplay();
            }
        }

        // Generate simulated data
        function generateSimulatedData() {
            const sensors = {};
            for (let i = 1; i <= 21; i++) {
                sensors[`s${i}`] = 500 + Math.random() * 2000;
            }
            
            return {
                engine_id: engineId,
                cycle: currentCycle,
                max_cycle: maxCycle,
                setting1: 0.0023,
                setting2: 0.0003,
                setting3: 100.0,
                sensors: sensors,
                rul: maxCycle - currentCycle
            };
        }

        // Get health class based on degradation percentage
        function getHealthClass(degradationPercent) {
            if (degradationPercent < 60) return 'good';
            if (degradationPercent < 85) return 'warning';
            return 'danger';
        }

        // Update display
        function updateDisplay() {
            if (!sensorData) return;

            const rul = sensorData.rul;
            const degradationPercent = (currentCycle / maxCycle) * 100;
            
            // Update RUL
            elements.rulValue.textContent = rul;
            
            // Update progress
            elements.progressText.textContent = `Cycle ${currentCycle} / ${maxCycle} (${degradationPercent.toFixed(1)}%)`;
            elements.progressBar.style.width = `${degradationPercent}%`;
            
            // Update progress bar color
            elements.progressBar.className = 'progress-bar ' + 
                (degradationPercent < 60 ? 'progress-good' :
                 degradationPercent < 85 ? 'progress-warning' : 'progress-danger');
            
            // Critical warning
            if (degradationPercent >= 85) {
                elements.criticalWarning.classList.remove('hidden');
                elements.criticalMessage.textContent = 
                    `Engine lifecycle has exceeded safe operational limits (${degradationPercent.toFixed(1)}%). Immediate maintenance required to prevent catastrophic failure.`;
            } else {
                elements.criticalWarning.classList.add('hidden');
            }
            
            // Update settings
            elements.setting1.textContent = sensorData.setting1;
            elements.setting2.textContent = sensorData.setting2;
            elements.setting3.textContent = sensorData.setting3;
            
            // Update engine info
            elements.engineInfo.textContent = `Engine ${engineId} - Cycle ${currentCycle} of ${maxCycle}`;
            
            // Update sensor cards
            updateSensorCards(degradationPercent);
        }

        // Update sensor cards with color-coded borders
        function updateSensorCards(degradationPercent) {
            const rul = sensorData.rul;
            const isEndOfLife = (rul === 0 || degradationPercent >= 100);
            
            // Show/hide end of life message
            if (isEndOfLife) {
                elements.endOfLifeMessage.classList.remove('hidden');
                elements.sensorsGrid.style.display = 'none';
                return;
            } else {
                elements.endOfLifeMessage.classList.add('hidden');
                elements.sensorsGrid.style.display = 'grid';
            }
            
            const healthClass = getHealthClass(degradationPercent);
            let cardsHTML = '';
            
            // Generate cards for selected sensor group
            for (let i = selectedGroupStart; i <= selectedGroupEnd; i++) {
                const sensorName = `s${i}`;
                const sensorValue = sensorData.sensors[sensorName];
                
                cardsHTML += `
                    <div class="sensor-card health-${healthClass}">
                        <div class="sensor-card-header">
                            <div class="sensor-card-name">S${i}</div>
                            <div class="sensor-card-status ${healthClass}"></div>
                        </div>
                        <div class="sensor-card-value">${sensorValue.toFixed(4)}</div>
                        <div class="sensor-card-label">Sensor Reading</div>
                    </div>
                `;
            }
            
            elements.sensorsGrid.innerHTML = cardsHTML;
        }

        // Play/Pause functionality
        function togglePlay() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                // If at end of life, reset to cycle 1
                const rul = sensorData ? sensorData.rul : maxCycle - currentCycle;
                if (rul === 0 || currentCycle >= maxCycle) {
                    currentCycle = 1;
                    elements.currentCycle.value = 1;
                }
                
                elements.playBtn.textContent = 'Pause';
                elements.playBtn.className = 'btn btn-danger';
                startAutoPlay();
            } else {
                elements.playBtn.textContent = 'Play';
                elements.playBtn.className = 'btn btn-primary';
                stopAutoPlay();
            }
        }

        function startAutoPlay() {
            playInterval = setInterval(() => {
                if (currentCycle < maxCycle) {
                    currentCycle++;
                    elements.currentCycle.value = currentCycle;
                    fetchSensorData();
                } else {
                    togglePlay();
                }
            }, 800);
        }

        function stopAutoPlay() {
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        // Event listeners
        function attachEventListeners() {
            elements.engineId.addEventListener('change', (e) => {
                engineId = parseInt(e.target.value);
                currentCycle = 1;
                elements.currentCycle.value = 1;
                
                // Reset end of life display
                elements.endOfLifeMessage.classList.add('hidden');
                elements.sensorsGrid.style.display = 'grid';
                
                fetchSensorData();
            });

            elements.currentCycle.addEventListener('change', (e) => {
                currentCycle = Math.min(parseInt(e.target.value) || 1, maxCycle);
                fetchSensorData();
            });

            elements.playBtn.addEventListener('click', togglePlay);
        }

        // Initialize app
        init();
    </script>
</body>
</html>